<style>
  .search-wrapper {
    display: flex;
    flex-direction: column;
    gap: .25rem;
  }

  .card {
    border-bottom: 0.4px solid black;
    /* background-color: white; */
    padding: 1.0rem;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }

  .card>.header {
    margin-bottom: .25rem;
  }

  .card>.body {
    font-size: .8rem;
    color: #777;
  }

  .hide {
    display: none;
  }

  .sdiv {
    position: absolute;
    z-index: 3;
    top: 114px;
    left: 30.08%;
    width: 570px;
  }

  .searchBar {
    z-index: 3;
  }
</style>
<header class="header">
  <div class="header-top">
    <div class="container-fluid">
      <div class="header-left">
        <div class="header-dropdown">
          <a href="#">Usd</a>
          <div class="header-menu">
            <ul>
              <li><a href="#">Eur</a></li>
              <li><a href="#">Usd</a></li>
            </ul>
          </div><!-- End .header-menu -->
        </div><!-- End .header-dropdown -->

        <div class="header-dropdown">
          <a href="#">Eng</a>
          <div class="header-menu">
            <ul>
              <li><a href="#">English</a></li>
              <li><a href="#">French</a></li>
              <li><a href="#">Spanish</a></li>
            </ul>
          </div><!-- End .header-menu -->
        </div><!-- End .header-dropdown -->
      </div><!-- End .header-left -->

      <div class="header-right">
        <ul class="top-menu">
          <li>
            <a href="#">Links</a>
            <ul>
              <% if(locals.user) {%>
              <li><a href=""><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                  </svg><a href="/my-account"><%= locals.user.name %> </a></li>
              <% }else {%>
              <li><a href=""><a href="">GUEST</a></li>
              <% } %>

              <li><a href="/wishlist"><i class="icon-heart-o"></i>Wishlist <span>(3)</span></a></li>
              <li><a href="https://soorya2020.github.io/soorya-portfolio/">About Us</a></li>
              <li><a href="">Contact Us</a></li>
              <% if(locals.loggedIn) {%>
              <li><a href="/logout"><i class="icon-user"></i>Logout</a></li>
              <% }else{ %>
              <li><a href="/login"><i class="icon-user"></i>Login</a></li>
              <% } %>


            </ul>
          </li>
        </ul><!-- End .top-menu -->
      </div><!-- End .header-right -->
    </div><!-- End .container -->
  </div><!-- End .header-top -->

  <div class="header-middle sticky-header">
    <div class="container-fluid">
      <div class="header-left">
        <button class="mobile-menu-toggler">
          <span class="sr-only">Toggle mobile menu</span>
          <i class="icon-bars"></i>
        </button>

        <a href="#" class="logo">
          <img src="/assets/images/logo.png" alt="Molla Logo" width="105" height="25">
        </a>

        <nav class="main-nav">
          <ul class="menu sf-arrows">
            <li class="megamenu-container ">
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/shop">Shop</a>
            </li>
            <li>
              <a href="/orders">Orders</a>
            </li>
            <li>
              <a href="https://soorya2020.github.io/soorya-portfolio/">About</a>
            </li>
          </ul><!-- End .menu -->
        </nav><!-- End .main-nav -->
      </div><!-- End .header-left -->

      <div class="header-right">
        <div class="header-search">
            <a href="#" class="search-toggle" role="button" title="Search"><i class="icon-search"></i></a>
            <form action="#" method="get">
              <div class="header-search-wrapper">
                <label for="q" class="sr-only">Search</label>
                <input type="search" class="form-control" onkeyup="closeSearch()" autocomplete="off" name="q" id="q" data-search placeholder="Search in..." required>
              </div><!-- End .header-search-wrapper -->
            </form>
          </div><!-- End .header-search -->
        <div class="dropdown compare-dropdown">
          <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static" title="Compare Products" aria-label="Compare Products">
            <i class="icon-random"></i>
          </a>
        </div><!-- End .compare-dropdown -->

        <div class="dropdown cart-dropdown">
          <a href="/cart" class="dropdown-toggle">
            <i class="icon-shopping-cart"></i>
            <span href="/cart" class="cart-count" id="cart-count"><%= locals?.cartCount? locals.cartCount:0  %></span>
          </a>

          <!-- <div class="dropdown-menu dropdown-menu-right"> -->
          <!-- <div class="dropdown-cart-products">
                            <div class="product">
                                <div class="product-cart-details">
                                    <h4 class="product-title">
                                        <a href="product.html">Beige knitted elastic runner shoes</a>
                                    </h4>

                                    <span class="cart-product-info">
                                        <span class="cart-product-qty">1</span>
                                        x $84.00
                                    </span>
                                </div>

                                <figure class="product-image-container">
                                    <a href="product.html" class="product-image">
                                        <img src="images/products/cart/product-1.jpg" alt="product">
                                    </a>
                                </figure>
                                <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                            </div>

                            <div class="product">
                                <div class="product-cart-details">
                                    <h4 class="product-title">
                                        <a href="product.html">Blue utility pinafore denim dress</a>
                                    </h4>

                                    <span class="cart-product-info">
                                        <span class="cart-product-qty">1</span>
                                        x $76.00
                                    </span>
                                </div>

                                <figure class="product-image-container">
                                    <a href="product.html" class="product-image">
                                        <img src="images/products/cart/product-2.jpg" alt="product">
                                    </a>
                                </figure>
                                <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                            </div>
                        </div> -->

          <!-- <div class="dropdown-cart-total">
                            <span>Total</span>

                            <span class="cart-total-price">$160.00</span>
                        </div> -->

          <!-- <div class="dropdown-cart-action"> -->
          <!-- <a href="/cart" class="btn btn-primary">View Cart</a> -->
          <!-- <a  href="/checkout" class="btn btn-outline-primary-2"><span>Checkout</span><i
                                    cl   </div><!-- End .header-right -->
        </div><!-- End .container -->
      </div><!-- End .header-middle -->
</header><!-- End .header -->

<div class=" mx-auto sdiv">
  <div class="user-cards" data-user-cards-container></div>
  <template data-user-template>
    <div class="card" id="cardSearch" onclick="myFunction(this.querySelector('p'))" style="position: relative;">
      <div class="header" data-header></div>
      <div class="body" data-body></div>
      <p class="_id" id="idSearch" hidden data-id></p>
      <img data-img src="" style="height: 50px; width:50px; position: absolute; right: 10px;">
    </div>
  </template>
</div>


<script>
  const userCardTemplate = document.querySelector("[data-user-template]")
  const userCardContainer = document.querySelector("[data-user-cards-container]")
  const searchInput = document.querySelector("[data-search]")
  let boolSearch = userCardContainer.classList
  if (searchInput.value.trim().length == 0) {
    boolSearch.add("hide")
  } else {
    boolSearch.remove("hide")
  }
  let products = [new Set()]
  searchInput.addEventListener("input", e => {
    const value = e.target.value.trim().toLowerCase()
    products.forEach(product => {
      const isVisible =
        product.name.toLowerCase().includes(value) ||
        product.category.includes(value)
      product.element.classList.toggle("hide", !isVisible)
    })
  })

  fetch("/getProducts", {
      method: 'get',
      headers: {
        'Content-Type': 'application/json',
      },
    })
    .then(res => res.json())
    .then(data => {
      
      console.log(data);
      products = data.map(product => {
        const card = userCardTemplate.content.cloneNode(true).children[0]
        const header = card.querySelector("[data-header]")
        const body = card.querySelector("[data-body]")
        const id = card.querySelector("[data-id]")
        const image = card.querySelector("[data-img]")
        header.textContent = product.name
        body.textContent = product.category
        id.textContent = product._id
        image.src = `/product-images/${product.img[0]}`
        userCardContainer.append(card)
        return {
          name: product.name,
          category: product.category,
          id: product._id,
          element: card
        }
      })
    })

  function myFunction(input) {
    let tag = input.innerText
    location.href = `/single-product/${tag}`
  }

  function closeSearch() {
  
    let boolSearch = userCardContainer.classList
    if (searchInput.value.trim().length == 0) {
      boolSearch.add("hide")
    } else {
      boolSearch.remove("hide")
    }
  }
</script>